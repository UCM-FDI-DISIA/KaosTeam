#include "ExploitableComponent.h"
#include "MovementComponentBomb.h"
#include "../scenes/RoomScene.h"

ExploitableComponent::ExploitableComponent() : Component(), coll(nullptr) {
}
ExploitableComponent::~ExploitableComponent() {
	coll = nullptr;
}

void ExploitableComponent::initComponent() {
	coll = static_cast<ColliderComponent*>(ent->getComponent(COLLIDER_COMPONENT));

	//Añadimos callback para que el objeto pueda ser destruido con bombas
	coll->GetTransofmCollider()->AddCall([this](Entity* e, Collider c) {checkCollisionsWithBombs(e, c); });
}

void ExploitableComponent::checkCollisionsWithBombs(Entity* e, Collider c) {
	if (e->getName() == BOMB_ENTITY) {
		//Como si o si tiene que colisionar con la bomba, explotamos la bomba aquí
		MovementComponentBomb* moveBomb = static_cast<MovementComponentBomb*>(e->getComponent(MOVEMENT_COMPONENT));
		moveBomb->explodeBomb();
		ent->getScene()->removeEntity(this->ent); //Removemos este objeto
	}
}