#include "ExploitableComponent.h"
#include "MovementComponentBomb.h"
#include "../scenes/RoomScene.h"

ExploitableComponent::ExploitableComponent() : Component(), shockWithBomb(false),/* lf(nullptr),*/ coll(nullptr) {
}
ExploitableComponent::~ExploitableComponent() {
	coll = nullptr;
}

void ExploitableComponent::initComponent() {
	coll = static_cast<ColliderComponent*>(ent->getComponent(COLLIDER_COMPONENT));

	//Añadimos callback para que el objeto pueda ser destruido con bombas
	coll->GetTransofmCollider()->AddCall([this](Entity* e, Collider c) {checkCollisionsWithBombs(e, c); });
}

void ExploitableComponent::checkCollisionsWithBombs(Entity* e, Collider c) {
	if (!shockWithBomb) {	//primero comprobamos que no haya chocado con niguna bomba
		if (e->getName() == BOMB_ENTITY) {
			shockWithBomb = true; //Ponemos booleano a true para que no quite vidas de más
			ent->getScene()->removeEntity(this->ent); //Removemos este objeto
		}
	}
}